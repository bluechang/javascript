<!DOCTYPE html>
<html lang="zh-cn">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="renderer" content="webkit">
	<meta name="format-detection" content="telephone=no">
	<meta name="format-detection" content="email=no">
	<title>shake</title>
	<link rel="stylesheet" href="static/css/reset.css"> 
</head>
<body>
	
	<script type="text/javascript" src="static/lib/jquery.min.js"></script>
	<script type="text/javascript">
			// 摇一摇
			var Shake = {
				init: function(opts){
					var t = this;			

					t.opts = $.extend(true, {}, t.defaultOpts, opts || {});			

					t.x = t.y = t.z = t.lastX = t.lastY = t.lastZ = 0;
					t.isDone = false;

				    //判断是否支持h5摇一摇
				    if (window.DeviceMotionEvent){
				        t.initEvent();
				    }else {
				    	alert('你的手机竟然不支持摇一摇, 太out了！！！');
					};
				},

				// 初始化事件
				initEvent: function(){  
					var t = this;		

                    window.addEventListener('devicemotion', t.listener.bind(t), false);
				},

				// 监听
				listener: function(event){   
					var t = this;			
                    var acceleration = event.accelerationIncludingGravity;

                    t.x = acceleration.x;
                    t.y = acceleration.y;
                    t.z = acceleration.z;	

                    if (Math.abs(t.x - t.lastX) > t.opts.speed || Math.abs(t.y - t.lastY) > t.opts.speed || Math.abs(t.z - t.lastZ) > t.opts.speed) {		
                        
                        // 保证只执行一次
                    	if(!t.isDone){
                    		t.isDone = true;

	                        //手机震动1秒
		                    if (navigator.vibrate) {
		                        navigator.vibrate(1000);
		                    } else if (navigator.webkitVibrate) {
		                        navigator.webkitVibrate(1000);
		                    }
	                        
	                        //回调
	                        t.opts.callback && t.opts.callback();
                    	} 
                    };

                    t.lastX = t.x;
                    t.lastY = t.y;
                    t.lastZ = t.z;
				},

				// 默认参数
				defaultOpts: {
					speed: 25					// 摇速
				}
			};

			// 初始化
			Shake.init({
				speed: 25,						// 摇速
				callback: function(){			// 回调
					alert("OK");
				}
			});

	</script>

</body>
</html>